# .github/workflows/update-counter.yml
name: Update Counter

on:
  schedule:
    # Winter time (CET, UTC+1):
    #  - All days in Jan, Feb, Nov, Dec  → 00:00 CET = 23:00 UTC previous day
    - cron: '0 23 * 1,2,11,12 *'
    #  - March 29 (before the last-Sunday DST jump) → 00:00 CET = 23:00 UTC
    - cron: '0 23 1-29 3 *'

    # Summer time (CEST, UTC+2):
    #  - March 25–31 (from last Sunday in Mar onward) → 00:00 CEST = 22:00 UTC
    - cron: '0 22 30-31 3 *'
    #  - April through September → 00:00 CEST = 22:00 UTC
    - cron: '0 22 * 4-9 *'
    #  - October 1–24 (up until the last-Sunday fallback) → 00:00 CEST = 22:00 UTC
    - cron: '0 22 1-26 10 *'

    # Back to winter time (CET, UTC+1):
    #  - October 25–31 (from last Sunday in Oct onward) → 00:00 CET = 23:00 UTC
    - cron: '0 23 27-31 10 *'

  workflow_dispatch: # Permite ejecutar manualmente

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Update HTML
        run: |
          # Calcular días transcurridos
          start_date="2025-06-13"
          current_date=$(date +%Y-%m-%d)
          
          # Convertir fechas a segundos desde epoch
          start_seconds=$(date -d "$start_date" +%s)
          current_seconds=$(date -d "$current_date" +%s)
          
          # Calcular diferencia en días
          days=$(( (current_seconds - start_seconds) / 86400 ))
          
          # Si es negativo, poner 0
          if [ $days -lt 0 ]; then
            days=0
          fi
          
          # Actualizar meta tags en index.html
          sed -i "s/<meta property=\"og:description\" content=\"[^\"]*\"/<meta property=\"og:description\" content=\"Han pasado $days días\"/g" index.html

          
      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add index.html
          git diff --staged --quiet || git commit -m "Update counter: $(date +%Y-%m-%d)"
          git push