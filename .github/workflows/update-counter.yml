# .github/workflows/update-counter.yml
name: Update Counter

on:
  schedule:
    - cron: '0 22 * * *'

  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Update HTML counter
        shell: bash
        run: |
          start_date="2025-06-13"
          current_date=$(date +%Y-%m-%d)

          # Pasar a segundos desde epoch
          start_s=$(date -d "$start_date" +%s)
          now_s=$(date -d "$current_date" +%s)

          # Dif in days (si es negativo, 0)
          diff=$(( (now_s - start_s) / 86400 ))
          if [ "$diff" -lt 0 ]; then
            diff=0
          fi

          # Reemplazar meta tag. 
          # Usamos | como separador para no escapar /
          sed -i \
            -E 's|<meta property="og:description" content="[^"]*"|<meta property="og:description" content="Desde el 13 de junio de 2025, **'"$diff"'** dÃ­as transcurridos"|' \
            index.html

      - name: Commit & push changes
        shell: bash
        run: |
          git config user.email "action@github.com"
          git config user.name "GitHub Action"
          git add index.html
          if ! git diff --staged --quiet; then
            git commit -m "Update counter: $(date +%Y-%m-%d)"
            git push
          else
            echo "No changes to commit."
          fi
